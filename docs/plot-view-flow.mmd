sequenceDiagram
    autonumber
    actor Browser as Client/Browser
    participant MW as Latency Middleware
    participant Route as FastAPI /plot
    participant Service as PlotService
    participant Record as AnomalyDetectionRecord
    participant DB as PostgreSQL
    participant Store as LocalStorage
    participant FS as Local Filesystem
    participant Plotly as Plotly Renderer

    Browser->>MW: GET /plot?series_id=...[&version=vN]
    MW->>Route: call_next(request)
    Route->>Route: Validate SeriesId + Version
    Route->>Service: render_training_data(series_id, version)
    Service->>Record: get_last_training_data() or get_training_data()
    Record->>DB: SELECT metadata row
    DB-->>Record: data_path + version
    Record-->>Service: metadata dict
    Service->>Store: load_data(data_path)
    Store->>FS: read training data JSON
    FS-->>Store: TimeSeries payload
    Store-->>Service: TimeSeries
    Service->>Plotly: px.bar(...) + to_html(...)
    Plotly-->>Service: chart HTML
    Service-->>Route: full HTML document
    Route-->>MW: 200 text/html
    MW-->>Browser: 200 text/html
